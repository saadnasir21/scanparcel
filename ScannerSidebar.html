‚ÄÉ
<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      #statusMessage { margin-top:8px; font-weight:bold; color:#007500; }
      button { margin-right:4px; }
    </style>
    <script>
      // show a quick non-blocking message
      function showMessage(msg) {
        var div = document.getElementById('statusMessage');
        div.textContent = msg;
        setTimeout(()=> div.textContent = '', 1500);
      }

      // scan handler
      function submitScan() {
        var inp = document.getElementById('parcelInput');
        var code = inp.value.trim();
        if (!code) return;
        google.script.run
          .withSuccessHandler(res=>{
            if (res==='Dispatched')       showMessage('‚úì Dispatched');
            else if (res==='confirmReturn') {
              // confirm before return
              if (confirm('Marked Dispatched ‚Äî mark as Returned instead?')) {
                google.script.run
                  .withSuccessHandler(r2=>{
                    showMessage(r2==='Returned'? '‚Ü∫ Returned' : 'ERR:'+r2);
                  })
                  .processParcelConfirmReturn(code);
              } else showMessage('‚èé Skipped');
            }
            else if (res==='confirmDuplicate') {
              var msg = 'Multiple orders for this customer. Dispatch anyway?';
              if (confirm(msg)) {
                google.script.run
                  .withSuccessHandler(r2=>{
                    showMessage(r2==='Dispatched'? '‚úì Dispatched' : 'ERR:'+r2);
                  })
                  .processParcelConfirmDuplicate(code);
              } else showMessage('‚èé Held');
            }
            else if (res==='AlreadyReturned') showMessage('‚ö†Ô∏è Already returned');
            else if (res==='NotFound')        showMessage('‚ùå Not found');
            else showMessage('?? '+res);
            resetInput();
          })
          .processParcelScan(code);
      }

      // undo handler
      function undoScan() {
        google.script.run
          .withSuccessHandler(res=>{
            if (res==='Undone')    showMessage('‚Ü∂ Last scan undone');
            else if (res==='NoAction') showMessage('‚ö†Ô∏è Nothing to undo');
            else showMessage('ERR:'+res);
          })
          .undoLastScan();
      }

      function resetInput() {
        var inp = document.getElementById('parcelInput');
        inp.value = '';
        inp.focus();
      }

      document.addEventListener('DOMContentLoaded',()=>{
        var inp = document.getElementById('parcelInput');
        inp.focus();
        inp.addEventListener('keyup', e=>{
          if (e.keyCode===13) submitScan();
        });
      });
    </script>
  </head>
  <body>
  <input type="text" id="parcelInput" placeholder="Scan Parcel Here" autofocus style="width:70%">
  <button onclick="submitScan()">Scan</button>
  <button onclick="undoScan()">Undo Last Scan</button>
  <button onclick="cancelManual()">Cancel Order</button>
  <button onclick="cancelByOrderNumber()">Cancel by Order #</button>
  <div id="statusMessage"></div>

  <script>

    function cancelManual() {
      const code = document.getElementById('parcelInput').value.trim();
      if (!code) return;

      if (!confirm("Are you sure this order was cancelled by customer?")) return;

      google.script.run.withSuccessHandler(res => {
        const map = {
          'Cancelled': '‚úÖ Cancelled & synced to Shopify',
          'TooLate':   '‚ö†Ô∏è Already dispatched/returned',
          'NotFound':  '‚ùå Parcel not found',
          'OrderNotFoundOnShopify': 'üõë Shopify order not found',
          'ShopifyFail': '‚ùå Failed to cancel on Shopify',
          'MissingHeaders': '‚ö†Ô∏è Check column headers'
        };
        showMessage(map[res] || res);
        resetInput();
      }).cancelOrderByCustomer(code);
    }

    function cancelByOrderNumber() {
      const code = document.getElementById('parcelInput').value.trim();
      if (!code) return;

      if (!confirm("Are you sure this order was cancelled by customer?")) return;

      google.script.run.withSuccessHandler(res => {
        const map = {
          'Cancelled': '‚úÖ Cancelled & synced to Shopify',
          'TooLate':   '‚ö†Ô∏è Already dispatched/returned',
          'NotFound':  '‚ùå Order not found',
          'OrderNotFoundOnShopify': 'üõë Shopify order not found',
          'ShopifyFail': '‚ùå Failed to cancel on Shopify',
          'MissingHeaders': '‚ö†Ô∏è Check column headers'
        };
        showMessage(map[res] || res);
        resetInput();
      }).cancelOrderByNumber(code);
    }
  </script>
</body>

</html>
